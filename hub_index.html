<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Networked World</title>
    <meta name="description" content="VR Networked World" />

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.8.0/dist/networked-aframe.min.js"></script>

    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/oneWaveAdrian/aframe-particle-system-component@aframe-1.2.0-upgrade/dist/aframe-particle-system-component.min.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>

    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  </head>

  <body>
    
    
    <a-scene
      networked-scene="
      room: basic;
      adapter: easyrtc;
      audio: true;
      debug: true;
    "
       fog="type: linear; color: #9ef5ff; far: 250; near: 80" 
    >
<!--       fog="type: linear; color: #9ef5ff; far: 250; near: 80" -->
      <a-assets>
        <img id="my-image" src="https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2F4.jpg?v=1626149010514">
        
        <img id="gwass" src="https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2Fgrass3.png?v=1626898194020">
        
         <img id="cloud" src="https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2Fcloud.png?v=1626899379262">
        <a-asset-item
          id="model"
          class="model"
          src="https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2Fhubbase11.glb?v=1626580020378"
        ></a-asset-item>
        
        <a-asset-item
          id="backgrnd"
          class="model"
          src="https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2Fsimpletemp.glb?v=1626995430774"
        ></a-asset-item>
        
        

        <a-asset-item
          id="body"
          src="https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2Fguy_head.glb?v=1626983272977"
        ></a-asset-item>

        <!-- Templates -->

        <template id="player-template">
          <a-entity networked-audio-source></a-entity>
        </template>

        <!-- Avatar -->

        <!--
        <template id="head-template">
          <a-entity class="avatar">
            <a-entity
              obj-model="obj: url(https://cdn.glitch.com/4e53a88a-96d2-46e5-ab4b-f8f1b9c2d486%2Fface.obj?1506059732633)"
              rotation="0 180 0"
              scale="0.01 0.01 0.01"
            ></a-entity>
          </a-entity>
        </template>
        -->

        <template id="head-template">
          <a-entity class="avatar">
            <a-entity
              class="head"
              gltf-model="#body"
              rotation="0 180 0"
              position="0 -.6 0"
              scale="0.2 0.2 0.2"
            ></a-entity>
            <!--
            <a-entity id="ctlL"
                      teleport-controls="cameraRig: #cameraRig; teleportOrigin: #head; 
                                         startEvents: teleportstart; endEvents: teleportend"></a-entity>
          -->
          </a-entity>
        </template>

        <!-- /Templates -->

        <template id="hand-template">
          <a-entity>
            <!--             <a-box scale="0.1 0.1 0.1"></a-box> -->
            <a-sphere color="red" radius="0.1"></a-sphere>
          </a-entity>
        </template>
      </a-assets>

      <a-entity
        id="player"
        networked="template:#player-template;attachTemplateToLocal:false;"
        spawn-in-circle="radius:3"
      >
        <a-entity
          id="head"
          camera
          position="0 1.6 0"
          look-controls
          wasd-controls
          networked="template:#head-template;attachTemplateToLocal:false;"
        >
          <a-sphere class="head" random-color visible="false"></a-sphere>
        </a-entity>

        <a-entity
          id="ctlL"
          teleport-controls="cameraRig: #player; teleportOrigin: #head; startEvents: teleportstart; endEvents: teleportend"
          raycaster="objects: .collidable; far:1.2;"
          laser-controls="hand: left"
          input-listen
        >
          <a-text
            value="X: Teleport"
            position="0 0.05 0"
            rotation="-90 2 0"
            scale="0.1 0.1 0.1"
            align="center"
            color="#FFFFFF"
          ></a-text>
        </a-entity>

        <a-entity
          id="ctlR"
          raycaster="objects: .collidable; far:1.2;"
          laser-controls="hand: right"
          input-listen
        >
          <a-text
            value="This is your hand!"
            position="0 0.05 0"
            rotation="-90 0 0"
            scale="0.1 0.1 0.1"
            align="center"
            color="#FFFFFF"
          ></a-text>
        </a-entity>

        <a-entity
          hand-controls="hand:left"
          networked="template:#hand-template;"
        ></a-entity>
        <a-entity
          hand-controls="hand:right"
          networked="template:#hand-template;"
        ></a-entity>
      </a-entity>

      <!--
      <a-entity id="player"
                camera
                networked="template:#head-template;attachTemplateToLocal:false;"
                position="0 1.6 0"
                spawn-in-circle="radius:3"
                wasd-controls
                look-controls>
        <a-sphere class="head"
          visible="false"
          random-color
        ></a-sphere>
      </a-entity>
      -->

      <a-sky
        src="https://cdn.glitch.com/59952914-2cb3-43c1-a89b-c73c3d6ebfcc%2Fsky.png?v=1624051483808"
      ></a-sky>

      <a-entity
        id="glbtest"
        gltf-model="#model"
        position="0 -10 0"
        scale="2 2 2"
      ></a-entity>
      
      <a-entity
        id="back"
        gltf-model="#backgrnd"
        position="-200 -10 0"
        scale="1 1 1"
      ></a-entity>
      
          <a-sphere position="-500 20 3" color="#c4baad"></a-sphere>

      <a-sound
        src="url(https://cdn.glitch.com/3ea982eb-b261-42c1-8739-a877a49f050f%2Fhubworld.mp3?v=1626897346208)"
        loop="true"
        autoplay="true"
        volume="1"
      ></a-sound>
      
      
<!--        <a-image src="#my-image" width="15" height="15"></a-image> -->
      
 <a-plane src="#gwass" position="0 -30 0" height="3000" width="3000" rotation="-90 0 0"></a-plane>
<!--    <a-plane src="#cloud" position="-200 -10 -200" height="300" width="300" rotation="0 0 0"></a-plane>    -->
    </a-scene>
    
  

    <script>
      // On mobile remove elements that are resource heavy
      var isMobile = AFRAME.utils.device.isMobile();

      if (isMobile) {
        var particles = document.getElementById("particles");
        particles.parentNode.removeChild(particles);
      }

      // Define custom schema for syncing avatar color, set by random-color
      //    NAF.schemas.add({
      //     template: '#player-template',
      //     components: [
      //       'position',
      //       'rotation',
      //       {
      //         selector: '.head',
      //         component: 'material',
      //         property: 'color'
      //       }
      //     ]
      //   });
      //
    </script>

    <script>
      AFRAME.registerComponent("input-listen", {
        schema: {
          inputTemplate: { default: "#input-template" }
        },

        init: function() {
          //X-button Pressed
          this.el.addEventListener("xbuttondown", function(e) {
            this.emit("teleportstart");
          });

          //X-button Released
          this.el.addEventListener("xbuttonup", function(e) {
            this.emit("teleportend");
          });
        }
      });
    </script>
    
    
  </body>
</html>
